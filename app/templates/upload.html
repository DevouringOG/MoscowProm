<!DOCTYPE html>
<html lang="ru">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Загрузка данных предприятий</title>
 <link rel="stylesheet" href="/static/css/main.css">
 <style>
 * {
 margin: 0;
 padding: 0;
 box-sizing: border-box;
 }

 body {
 font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
 background: var(--accent-dark);
 min-height: 100vh;
 display: flex;
 align-items: center;
 justify-content: center;
 padding: 20px;
 }

 .container {
 background: var(--card-bg);box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
 max-width: 600px;
 width: 100%;
 padding: 40px;
 }

 h1 {
 color: var(--text-primary);
 margin-bottom: 10px;
 font-size: 28px;
 }

 .subtitle {
 color: var(--text-secondary);
 margin-bottom: 30px;
 font-size: 14px;
 }

 .upload-area {
 border: 2px dashed #667eea;padding: 40px;
 text-align: center;
 transition: all 0.3s;
 cursor: pointer;
 margin-bottom: 20px;
 }

 .upload-area:hover {
 border-color: var(--accent-dark);
 background: #f8f9ff;
 }

 .upload-area.dragover {
 background: #f0f2ff;
 border-color: var(--accent-dark);
 }

 .upload-icon {
 font-size: 48px;
 margin-bottom: 16px;
 }

 .upload-text {
 color: var(--text-secondary);
 margin-bottom: 8px;
 }

 .file-info {
 color: var(--accent-dark);
 font-weight: 500;
 margin-top: 12px;
 display: none;
 }

 input[type="file"] {
 display: none;
 }

 .btn {
 width: 100%;
 padding: 14px;
 background: var(--accent-dark);
 color: var(--card-bg);
 border: none;font-size: 16px;
 font-weight: 600;
 cursor: pointer;
 transition: transform 0.2s, box-shadow 0.2s;
 }

 .btn:hover {box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
 }

 .btn:disabled {
 background: #ccc;
 cursor: not-allowed;
 transform: none;
 }

 .progress {
 display: none;
 margin-top: 20px;
 }

 .progress-bar {
 width: 100%;
 height: 8px;
 background: #e0e0e0;overflow: hidden;
 }

 .progress-fill {
 height: 100%;
 background: var(--accent-dark);
 width: 0%;
 transition: width 0.3s;
 }

 .progress-text {
 text-align: center;
 margin-top: 8px;
 color: var(--text-secondary);
 font-size: 14px;
 }

 .result {
 margin-top: 20px;
 padding: 16px;display: none;
 }

 .result.success {
 background: #d4edda;
 border: 1px solid #c3e6cb;
 color: #155724;
 }

 .result.error {
 background: #f8d7da;
 border: 1px solid #f5c6cb;
 color: #721c24;
 }

 .result-title {
 font-weight: 600;
 margin-bottom: 8px;
 }

 .result-details {
 font-size: 14px;
 line-height: 1.6;
 }

 .back-link {
 display: inline-block;
 margin-top: 20px;
 color: var(--accent-dark);
 text-decoration: none;
 font-weight: 500;
 }

 .back-link:hover {
 text-decoration: underline;
 }
</style>
</head>
<body>
 <div class="container">
 <h1>Загрузка данных предприятий</h1>
 <p class="subtitle">Загрузите Excel файл с данными о предприятиях (208 столбцов)</p>

 <form id="uploadForm">
 <div class="upload-area" id="uploadArea">
 <div class="upload-icon"></div>
 <div class="upload-text">Нажмите или перетащите файл Excel</div>
 <div class="file-info" id="fileInfo"></div>
 <input type="file" id="fileInput" accept=".xlsx,.xls" required>
</div>

 <button type="submit" class="btn" id="submitBtn">Загрузить и обработать</button>
</form>

 <div class="progress" id="progress">
 <div class="progress-bar">
 <div class="progress-fill" id="progressFill"></div>
</div>
 <div class="progress-text" id="progressText">Обработка файла...</div>
</div>

 <div class="result" id="result"></div>

 <a href="/" class="back-link">← Вернуться на главную</a>
</div>

 <script>
 const uploadArea = document.getElementById('uploadArea');
 const fileInput = document.getElementById('fileInput');
 const fileInfo = document.getElementById('fileInfo');
 const form = document.getElementById('uploadForm');
 const submitBtn = document.getElementById('submitBtn');
 const progress = document.getElementById('progress');
 const progressFill = document.getElementById('progressFill');
 const progressText = document.getElementById('progressText');
 const result = document.getElementById('result');

 // Click to upload
 uploadArea.addEventListener('click', () => fileInput.click());

 // Drag and drop
 uploadArea.addEventListener('dragover', (e) => {
 e.preventDefault();
 uploadArea.classList.add('dragover');
 });

 uploadArea.addEventListener('dragleave', () => {
 uploadArea.classList.remove('dragover');
 });

 uploadArea.addEventListener('drop', (e) => {
 e.preventDefault();
 uploadArea.classList.remove('dragover');
 const files = e.dataTransfer.files;
 if (files.length > 0) {
 fileInput.files = files;
 showFileInfo(files[0]);
 }
 });

 // File selected
 fileInput.addEventListener('change', (e) => {
 if (e.target.files.length > 0) {
 showFileInfo(e.target.files[0]);
 }
 });

 function showFileInfo(file) {
 fileInfo.textContent = `Выбран: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
 fileInfo.style.display = 'block';
 }

 // Form submit
 form.addEventListener('submit', async (e) => {
 e.preventDefault();

 const file = fileInput.files[0];
 if (!file) {
 alert('Пожалуйста, выберите файл');
 return;
 }

 const formData = new FormData();
 formData.append('file', file);

 // Show progress
 submitBtn.disabled = true;
 progress.style.display = 'block';
 result.style.display = 'none';
 progressFill.style.width = '0%';

 try {
 // Simulate progress
 let progressValue = 0;
 const progressInterval = setInterval(() => {
 progressValue += Math.random() * 15;
 if (progressValue > 90) progressValue = 90;
 progressFill.style.width = progressValue + '%';
 }, 200);

 const response = await fetch('/upload', {
 method: 'POST',
 body: formData
 });

 clearInterval(progressInterval);
 progressFill.style.width = '100%';

 const data = await response.json();

 if (response.ok) {
 showResult('success', 'Файл успешно обработан!', 
 `Загружено организаций: ${data.organizations_count}<br>` +
 `Обработано строк: ${data.rows_processed}<br>` +
 `Ошибок: ${data.errors || 0}`
 );
 } else {
 showResult('error', 'Ошибка при обработке файла', data.detail || 'Неизвестная ошибка');
 }
 } catch (error) {
 showResult('error', 'Ошибка соединения', error.message);
 } finally {
 submitBtn.disabled = false;
 setTimeout(() => {
 progress.style.display = 'none';
 }, 1000);
 }
 });

 function showResult(type, title, details) {
 result.className = `result ${type}`;
 result.innerHTML = `
 <div class="result-title">${title}</div>
 <div class="result-details">${details}</div>
 `;
 result.style.display = 'block';
 }
</script>
</body>
</html>
