<!DOCTYPE html>
<html lang="ru">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Список организаций - MosProm</title>
 <link rel="stylesheet" href="/static/css/main.css">
 <style>
 body {
 background: var(--body-bg);
 margin: 0;
 padding: 0;
 }

 /* Page Header */
 .page-header {
 background: var(--card-bg);
 border-bottom: 1px solid var(--border-color);
 padding: 24px;
 margin-bottom: 24px;
 display: flex;
 justify-content: space-between;
 align-items: center;
 gap: 24px;
 }

 .header-left {
 display: flex;
 align-items: center;
 gap: 24px;
 }

 .header-logo {
 height: 60px;
 width: auto;
 }

 .page-title {
 font-size: 24px;
 font-weight: 700;
 color: var(--text-primary);
 text-transform: uppercase;
 letter-spacing: 0.5px;
 }

 .header-actions {
 display: flex;
 gap: 12px;
 }

 .btn-secondary {
 padding: 12px 24px;
 background: transparent;
 color: var(--text-primary);
 border: 2px solid var(--border-color);
 font-size: 14px;
 font-weight: 500;
 cursor: pointer;
 text-decoration: none;
 display: inline-flex;
 align-items: center;
 gap: 8px;
 transition: all 0.3s ease;
 white-space: nowrap;
 }

 .btn-secondary:hover {
 border-color: var(--accent-dark);
 color: var(--accent-dark);
 }

 .filter-actions .btn-secondary {
 min-width: auto;
 }

 .search-section {
 padding: 30px;
 background: var(--accent-light);
 border-bottom: 1px solid #e9ecef;
 }

 .search-container {
 display: flex;
 gap: 15px;
 max-width: 600px;
 margin-bottom: 20px;
 }

 .search-input {
 flex: 1;
 padding: 12px 20px;
 border: 2px solid #e9ecef;font-size: 14px;
 transition: border-color 0.3s ease;
 }

 .search-input:focus {
 outline: none;
 border-color: var(--accent-dark);
 }

 .filters-container {
 display: grid;
 grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
 gap: 20px;
 }

 .filter-group {
 display: flex;
 flex-direction: column;
 gap: 8px;
 background: var(--card-bg);
 border: 2px solid #e9ecef;padding: 0;
 overflow: hidden;
 }

 .filter-header {
 padding: 12px 15px;
 background: var(--accent-dark);
 user-select: none;
 }

 .filter-label {
 font-size: 13px;
 font-weight: 600;
 color: white;
 text-transform: uppercase;
 letter-spacing: 0.5px;
 display: flex;
 align-items: center;
 justify-content: space-between;
 }

 .filter-label-left {
 display: flex;
 align-items: center;
 gap: 8px;
 }

 .toggle-all-btn {
 background: var(--accent-dark);
 color: white;
 border: 2px solid var(--accent-dark);
 padding: 10px 20px;
 font-size: 14px;
 cursor: pointer;
 transition: all 0.3s ease;
 text-transform: uppercase;
 font-weight: 600;
 }

 .toggle-all-btn:hover {
 background: #5568d3;
 border-color: #5568d3;
 }

 .filter-count {
 background: var(--accent-dark);
 color: var(--card-bg);
 padding: 2px 8px;font-size: 11px;
 font-weight: 700;
 }

 .filter-content {
 display: flex;
 flex-direction: column;
 gap: 8px;
 padding: 10px;
 max-height: 300px;
 overflow: hidden;
 transition: max-height 0.3s ease, padding 0.3s ease;
 }

 .filter-content.collapsed {
 max-height: 0;
 padding: 0 10px;
 }

 .filter-search {
 padding: 8px 12px;
 border: 1px solid #dee2e6;font-size: 13px;
 width: 100%;
 transition: border-color 0.2s ease;
 }

 .filter-search:focus {
 outline: none;
 border-color: var(--accent-dark);
 }

 .filter-options {
 max-height: 200px;
 overflow-y: auto;
 display: flex;
 flex-direction: column;
 gap: 8px;
 }

 .filter-options::-webkit-scrollbar {
 width: 6px;
 }

 .filter-options::-webkit-scrollbar-track {
 background: #f1f1f1;}

 .filter-options::-webkit-scrollbar-thumb {
 background: var(--accent-dark);}

 .filter-option {
 display: flex;
 align-items: center;
 gap: 8px;
 cursor: pointer;
 padding: 5px;transition: background 0.2s ease;
 }

 .filter-option:hover {
 background: var(--accent-light);
 }

 .filter-option input[type="checkbox"] {
 width: 18px;
 height: 18px;
 cursor: pointer;
 accent-color: var(--accent-dark);
 }

 .filter-option label {
 flex: 1;
 cursor: pointer;
 font-size: 14px;
 color: var(--text-secondary);
 }

 .filter-option.hidden {
 display: none;
 }

 .no-results {
 padding: 10px;
 text-align: center;
 color: var(--text-secondary);
 font-size: 13px;
 font-style: italic;
 }

 .filter-select {
 padding: 10px 15px;
 border: 2px solid #e9ecef;font-size: 14px;
 background: var(--card-bg);
 cursor: pointer;
 transition: border-color 0.3s ease;
 }

 .filter-select:focus {
 outline: none;
 border-color: var(--accent-dark);
 }

 .filter-actions {
 display: flex;
 gap: 10px;
 align-items: center;
 margin-top: 20px;
 }

 .btn-primary {
 padding: 12px 24px;
 background: var(--accent-dark);
 color: white;
 border: 2px solid var(--accent-dark);
 font-size: 14px;
 font-weight: 500;
 cursor: pointer;
 text-decoration: none;
 display: inline-flex;
 align-items: center;
 gap: 8px;
 transition: all 0.3s ease;
 white-space: nowrap;
 }

 .btn-primary:hover {
 background: #5568d3;
 border-color: #5568d3;
 }

 .sort-controls {
 display: flex;
 gap: 8px;
 align-items: center;
 margin-left: auto;
 }

 .sort-label {
 font-size: 14px;
 font-weight: 600;
 color: var(--text-secondary);
 }

 .sort-select {
 padding: 10px 15px;
 border: 2px solid #e9ecef;
 font-size: 14px;
 background: var(--card-bg);
 cursor: pointer;
 transition: border-color 0.3s ease;
 }

 .sort-select:focus {
 outline: none;
 border-color: var(--accent-dark);
 }

 .sort-order-select {
 padding: 10px 15px;
 border: 2px solid #e9ecef;
 font-size: 14px;
 background: var(--card-bg);
 cursor: pointer;
 transition: border-color 0.3s ease;
 }

 .sort-order-select:focus {
 outline: none;
 border-color: var(--accent-dark);
 }

 .btn-search {
 background: var(--accent-dark);
 color: white;
 border: 2px solid var(--accent-dark);
 padding: 12px 30px;
 font-size: 14px;
 font-weight: 500;
 cursor: pointer;
 text-decoration: none;
 display: inline-flex;
 align-items: center;
 gap: 8px;
 transition: all 0.3s ease;
 }

 .btn-search:hover {
 background: #5568d3;
 border-color: #5568d3;
 }

 .stats {
 padding: 20px 30px;
 background: var(--accent-light);
 color: var(--text-secondary);
 font-size: 14px;
 }

 .active-filters {
 padding: 15px 30px;
 background: rgba(70, 80, 100, 0.3);
 border-bottom: 1px solid var(--border-color);
 display: flex;
 gap: 10px;
 align-items: center;
 flex-wrap: wrap;
 }

 .active-filters-label {
 font-weight: 600;
 color: var(--text-primary);
 }

 .filter-tag {
 display: inline-flex;
 align-items: center;
 gap: 8px;
 padding: 6px 12px;
 background: var(--card-bg);
 border: 1px solid var(--border-color);
 color: var(--text-primary);
 font-size: 13px;
 text-decoration: none;
 transition: all 0.2s ease;
 }

 .filter-tag:hover {
 background: var(--accent-dark);
 color: white;
 border-color: var(--accent-dark);
 }

 .filter-tag-remove {
 font-weight: bold;
 font-size: 14px;
 }

 .table-container {
 padding: 30px;
 overflow-x: auto;
 }

 table {
 width: 100%;
 border-collapse: collapse;
 }

 thead {
 background: var(--accent-light);
 }

 th {
 padding: 15px;
 text-align: left;
 font-weight: 600;
 color: var(--text-secondary);
 border-bottom: 2px solid #dee2e6;
 white-space: nowrap;
 }

 td {
 padding: 15px;
 border-bottom: 1px solid #e9ecef;
 }

 tbody tr {
 transition: background-color 0.2s ease;
 }

 tbody tr:hover {
 background: var(--accent-light);
 }

 .org-name {
 font-weight: 600;
 color: var(--accent-dark);
 text-decoration: none;
 transition: color 0.2s ease;
 }

 .org-name:hover {
 color: #5568d3;
 text-decoration: underline;
 }

 .inn-badge {
 background: #e7f3ff;
 color: #0066cc;
 padding: 4px 12px;font-size: 12px;
 font-weight: 500;
 font-family: 'Courier New', monospace;
 }

 .status-badge {
 padding: 4px 12px;font-size: 12px;
 font-weight: 500;
 }

 .status-active {
 background: #d4edda;
 color: #155724;
 }

 .status-inactive {
 background: #f8d7da;
 color: #721c24;
 }

 .pagination {
 padding: 30px;
 display: flex;
 justify-content: center;
 align-items: center;
 gap: 10px;
 border-top: 1px solid #e9ecef;
 }

 .page-btn {
 padding: 8px 16px;
 border: 1px solid #dee2e6;
 background: var(--card-bg);
 color: var(--text-secondary);cursor: pointer;
 text-decoration: none;
 transition: all 0.2s ease;
 }

 .page-btn:hover:not(.active):not(:disabled) {
 background: var(--accent-light);
 border-color: var(--accent-dark);
 }

 .page-btn.active {
 background: var(--accent-dark);
 color: var(--card-bg);
 border-color: var(--accent-dark);
 }

 .page-btn:disabled {
 opacity: 0.5;
 cursor: not-allowed;
 }

 .empty-state {
 text-align: center;
 padding: 60px 30px;
 color: var(--text-secondary);
 }

 .empty-state-icon {
 font-size: 64px;
 margin-bottom: 20px;
 opacity: 0.3;
 }

 .empty-state h2 {
 font-size: 24px;
 margin-bottom: 10px;
 }

 .empty-state p {
 font-size: 16px;
 }
</style>
</head>
<body>
 <div class="page-header">
 <div class="header-left">
 <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 80'%3E%3Cg fill='%23000000'%3E%3Cpath d='M20,50 L35,30 L35,60 Z'/%3E%3Cpath d='M40,50 L55,30 L55,60 Z'/%3E%3Cpath d='M60,50 L75,30 L75,60 Z'/%3E%3Crect x='15' y='60' width='65' height='15'/%3E%3Ccircle cx='52' cy='25' r='8'/%3E%3Cline x1='52' y1='17' x2='52' y2='10' stroke='%23000000' stroke-width='2'/%3E%3Cline x1='52' y1='10' x2='45' y2='15' stroke='%23000000' stroke-width='2'/%3E%3Cline x1='52' y1='10' x2='59' y2='15' stroke='%23000000' stroke-width='2'/%3E%3Cline x1='44' y1='25' x2='35' y2='25' stroke='%23000000' stroke-width='2'/%3E%3Cline x1='35' y1='25' x2='40' y2='20' stroke='%23000000' stroke-width='2'/%3E%3Cline x1='35' y1='25' x2='40' y2='30' stroke='%23000000' stroke-width='2'/%3E%3C/g%3E%3Ctext x='95' y='30' font-family='Arial, sans-serif' font-size='16' font-weight='bold' fill='%23000000'%3EИНДУСТРИАЛЬНЫЕ%3C/text%3E%3Ctext x='95' y='50' font-family='Arial, sans-serif' font-size='16' font-weight='bold' fill='%23000000'%3EДАННЫЕ%3C/text%3E%3Ctext x='95' y='70' font-family='Arial, sans-serif' font-size='16' font-weight='bold' fill='%23000000'%3EМОСКВЫ%3C/text%3E%3C/svg%3E" alt="Индустриальные данные Москвы" class="header-logo">
 <h1 class="page-title">СПИСОК ПРЕДПРИЯТИЙ</h1>
 </div>
 <div class="header-actions">
 <a href="/analytics" class="btn-secondary">АНАЛИТИКА</a>
 <a href="/organizations/create" class="btn-secondary">ДОБАВИТЬ</a>
 <a href="/upload" class="btn-secondary">ЗАГРУЗКА</a>
 </div>
 </div>

 <div class="container">

 <div class="search-section">
 <form action="/organizations" method="get">
 <div class="search-container">
 <input 
 type="text" 
 name="search" 
 class="search-input" 
 placeholder="Поиск по названию или ИНН..." 
 value="{{ search }}"
 >
 <button type="submit" class="btn btn-search">Поиск</button>
</div>

 <div class="filters-container">
 <!-- Отрасль -->
 <div class="filter-group">
 <div class="filter-header">
 <div class="filter-label">
 <div class="filter-label-left">
 <span>Отрасль</span>
</div>
 {% if selected_industries %}
 <span class="filter-count">{{ selected_industries|length }}</span>
 {% endif %}
</div>
</div>
 <div class="filter-content" id="content-industry">
 <input type="text" 
 class="filter-search" 
 placeholder=" Поиск отрасли..." 
 onkeyup="filterOptions('industry', this.value)">
 <div class="filter-options" id="options-industry">
 {% for ind in industries %}
 <div class="filter-option" data-value="{{ ind|lower }}">
 <input type="checkbox" 
 name="industry" 
 value="{{ ind }}" 
 id="industry_{{ loop.index }}"
 {% if ind in selected_industries %}checked{% endif %}>
 <label for="industry_{{ loop.index }}">{{ ind }}</label>
</div>
 {% endfor %}
</div>
 <div class="no-results" id="no-results-industry" style="display: none;">
 Ничего не найдено
</div>
</div>
</div>

 <!-- Округ -->
 <div class="filter-group">
 <div class="filter-header">
 <div class="filter-label">
 <div class="filter-label-left">
 <span> Округ</span>
</div>
 {% if selected_districts %}
 <span class="filter-count">{{ selected_districts|length }}</span>
 {% endif %}
</div>
</div>
 <div class="filter-content" id="content-district">
 <input type="text" 
 class="filter-search" 
 placeholder=" Поиск округа..." 
 onkeyup="filterOptions('district', this.value)">
 <div class="filter-options" id="options-district">
 {% for dist in districts %}
 <div class="filter-option" data-value="{{ dist|lower }}">
 <input type="checkbox" 
 name="district" 
 value="{{ dist }}" 
 id="district_{{ loop.index }}"
 {% if dist in selected_districts %}checked{% endif %}>
 <label for="district_{{ loop.index }}">{{ dist }}</label>
</div>
 {% endfor %}
</div>
 <div class="no-results" id="no-results-district" style="display: none;">
 Ничего не найдено
</div>
</div>
</div>

 <!-- Район -->
 <div class="filter-group">
 <div class="filter-header">
 <div class="filter-label">
 <div class="filter-label-left">
 <span> Район</span>
</div>
 {% if selected_regions %}
 <span class="filter-count">{{ selected_regions|length }}</span>
 {% endif %}
</div>
</div>
 <div class="filter-content" id="content-region">
 <input type="text" 
 class="filter-search" 
 placeholder=" Поиск района..." 
 onkeyup="filterOptions('region', this.value)">
 <div class="filter-options" id="options-region">
 {% for reg in regions %}
 <div class="filter-option" data-value="{{ reg|lower }}">
 <input type="checkbox" 
 name="region" 
 value="{{ reg }}" 
 id="region_{{ loop.index }}"
 {% if reg in selected_regions %}checked{% endif %}>
 <label for="region_{{ loop.index }}">{{ reg }}</label>
</div>
 {% endfor %}
</div>
 <div class="no-results" id="no-results-region" style="display: none;">
 Ничего не найдено
</div>
</div>
</div>

 <!-- Размер -->
 <div class="filter-group">
 <div class="filter-header">
 <div class="filter-label">
 <div class="filter-label-left">
 <span>Размер</span>
</div>
 {% if selected_sizes %}
 <span class="filter-count">{{ selected_sizes|length }}</span>
 {% endif %}
</div>
</div>
 <div class="filter-content" id="content-size">
 <input type="text" 
 class="filter-search" 
 placeholder=" Поиск размера..." 
 onkeyup="filterOptions('size', this.value)">
 <div class="filter-options" id="options-size">
 {% for sz in sizes %}
 <div class="filter-option" data-value="{{ sz|lower }}">
 <input type="checkbox" 
 name="size" 
 value="{{ sz }}" 
 id="size_{{ loop.index }}"
 {% if sz in selected_sizes %}checked{% endif %}>
 <label for="size_{{ loop.index }}">{{ sz }}</label>
</div>
 {% endfor %}
</div>
 <div class="no-results" id="no-results-size" style="display: none;">
 Ничего не найдено
</div>
</div>
</div>

 <div class="filter-actions">
 <button type="submit" class="btn-primary">Применить фильтры</button>
 <a href="/organizations" class="btn-secondary">Сбросить</a>
 <button type="button" class="btn-secondary" onclick="toggleAllFilters()" id="toggleAllBtn">Скрыть все фильтры</button>
 <button type="button" class="btn-secondary" onclick="exportToExcel()">📊 Выгрузить в Excel</button>
 
 <div class="sort-controls">
 <span class="sort-label">Сортировка:</span>
 <select name="sort_by" class="sort-select" onchange="this.form.submit()">
 <option value="name" {% if sort_by == 'name' %}selected{% endif %}>Название</option>
 <option value="inn" {% if sort_by == 'inn' %}selected{% endif %}>ИНН</option>
 <option value="main_industry" {% if sort_by == 'main_industry' %}selected{% endif %}>Отрасль</option>
 <option value="status_final" {% if sort_by == 'status_final' %}selected{% endif %}>Статус</option>
 <option value="district" {% if sort_by == 'district' %}selected{% endif %}>Округ</option>
 <option value="region" {% if sort_by == 'region' %}selected{% endif %}>Район</option>
 <option value="company_size" {% if sort_by == 'company_size' %}selected{% endif %}>Размер</option>
 </select>
 <select name="order" class="sort-order-select" onchange="this.form.submit()">
 <option value="asc" {% if order == 'asc' %}selected{% endif %}>По возрастанию</option>
 <option value="desc" {% if order == 'desc' %}selected{% endif %}>По убыванию</option>
 </select>
 </div>
 </div>
</div>
</form>
</div>

 {% if search or selected_industries or selected_districts or selected_regions or selected_sizes %}
 <div class="active-filters">
 <span class="active-filters-label"> Активные фильтры:</span>
 
 {% if search %}
 {% set params = [] %}
 {% for ind in selected_industries %}{% set _ = params.append('industry=' + ind) %}{% endfor %}
 {% for dist in selected_districts %}{% set _ = params.append('district=' + dist) %}{% endfor %}
 {% for reg in selected_regions %}{% set _ = params.append('region=' + reg) %}{% endfor %}
 {% for sz in selected_sizes %}{% set _ = params.append('size=' + sz) %}{% endfor %}
 {% set _ = params.append('sort_by=' + sort_by) %}
 {% set _ = params.append('order=' + order) %}
 <a href="/organizations?{{ '&'.join(params) }}" class="filter-tag">
 Поиск: "{{ search }}" <span class="filter-tag-remove">×</span>
</a>
 {% endif %}

 {% for ind in selected_industries %}
 {% set params = [] %}
 {% if search %}{% set _ = params.append('search=' + search) %}{% endif %}
 {% for i in selected_industries if i != ind %}{% set _ = params.append('industry=' + i) %}{% endfor %}
 {% for dist in selected_districts %}{% set _ = params.append('district=' + dist) %}{% endfor %}
 {% for reg in selected_regions %}{% set _ = params.append('region=' + reg) %}{% endfor %}
 {% for sz in selected_sizes %}{% set _ = params.append('size=' + sz) %}{% endfor %}
 {% set _ = params.append('sort_by=' + sort_by) %}
 {% set _ = params.append('order=' + order) %}
 <a href="/organizations?{{ '&'.join(params) }}" class="filter-tag">
 Отрасль: {{ ind }} <span class="filter-tag-remove">×</span>
</a>
 {% endfor %}

 {% for dist in selected_districts %}
 {% set params = [] %}
 {% if search %}{% set _ = params.append('search=' + search) %}{% endif %}
 {% for ind in selected_industries %}{% set _ = params.append('industry=' + ind) %}{% endfor %}
 {% for d in selected_districts if d != dist %}{% set _ = params.append('district=' + d) %}{% endfor %}
 {% for reg in selected_regions %}{% set _ = params.append('region=' + reg) %}{% endfor %}
 {% for sz in selected_sizes %}{% set _ = params.append('size=' + sz) %}{% endfor %}
 {% set _ = params.append('sort_by=' + sort_by) %}
 {% set _ = params.append('order=' + order) %}
 <a href="/organizations?{{ '&'.join(params) }}" class="filter-tag">
 Округ: {{ dist }} <span class="filter-tag-remove">×</span>
</a>
 {% endfor %}

 {% for reg in selected_regions %}
 {% set params = [] %}
 {% if search %}{% set _ = params.append('search=' + search) %}{% endif %}
 {% for ind in selected_industries %}{% set _ = params.append('industry=' + ind) %}{% endfor %}
 {% for dist in selected_districts %}{% set _ = params.append('district=' + dist) %}{% endfor %}
 {% for r in selected_regions if r != reg %}{% set _ = params.append('region=' + r) %}{% endfor %}
 {% for sz in selected_sizes %}{% set _ = params.append('size=' + sz) %}{% endfor %}
 {% set _ = params.append('sort_by=' + sort_by) %}
 {% set _ = params.append('order=' + order) %}
 <a href="/organizations?{{ '&'.join(params) }}" class="filter-tag">
 Район: {{ reg }} <span class="filter-tag-remove">×</span>
</a>
 {% endfor %}

 {% for sz in selected_sizes %}
 {% set params = [] %}
 {% if search %}{% set _ = params.append('search=' + search) %}{% endif %}
 {% for ind in selected_industries %}{% set _ = params.append('industry=' + ind) %}{% endfor %}
 {% for dist in selected_districts %}{% set _ = params.append('district=' + dist) %}{% endfor %}
 {% for reg in selected_regions %}{% set _ = params.append('region=' + reg) %}{% endfor %}
 {% for s in selected_sizes if s != sz %}{% set _ = params.append('size=' + s) %}{% endfor %}
 {% set _ = params.append('sort_by=' + sort_by) %}
 {% set _ = params.append('order=' + order) %}
 <a href="/organizations?{{ '&'.join(params) }}" class="filter-tag">
 Размер: {{ sz }} <span class="filter-tag-remove">×</span>
</a>
 {% endfor %}
</div>
 {% endif %}

 <div class="stats">
 Найдено организаций: <strong>{{ total }}</strong>
</div>

 <div class="table-container">
 {% if organizations %}
 <table>
 <thead>
 <tr>
 <th>Название</th>
 <th>ИНН</th>
 <th>Отрасль</th>
 <th>Статус</th>
 <th>Район</th>
 <th>Размер</th>
</tr>
</thead>
 <tbody>
 {% for org in organizations %}
 <tr>
 <td>
 <a href="/organizations/{{ org.id }}" class="org-name">
 {{ org.name }}
</a>
</td>
 <td>
 <span class="inn-badge">{{ org.inn }}</span>
</td>
 <td>{{ org.main_industry or '—' }}</td>
 <td>
 <span class="status-badge status-active">
 {{ org.status_final or org.status_spark or 'Активно' }}
</span>
</td>
 <td>{{ org.region or org.district or '—' }}</td>
 <td>{{ org.company_size or org.company_size_2022 or '—' }}</td>
</tr>
 {% endfor %}
</tbody>
</table>
 {% else %}
 <div class="empty-state">
 <div class="empty-state-icon"></div>
 <h2>Организации не найдены</h2>
 <p>
 {% if search %}
 По запросу "{{ search }}" ничего не найдено. Попробуйте изменить условия поиска.
 {% else %}
 База данных пуста.
 {% endif %}
</p>
</div>
 {% endif %}
</div>

 {% if total_pages > 1 %}
 <div class="pagination">
 {% set query_params = [] %}
 {% if search %}{% set _ = query_params.append('search=' + search) %}{% endif %}
 {% for ind in selected_industries %}{% set _ = query_params.append('industry=' + ind) %}{% endfor %}
 {% for dist in selected_districts %}{% set _ = query_params.append('district=' + dist) %}{% endfor %}
 {% for reg in selected_regions %}{% set _ = query_params.append('region=' + reg) %}{% endfor %}
 {% for sz in selected_sizes %}{% set _ = query_params.append('size=' + sz) %}{% endfor %}
 {% set _ = query_params.append('sort_by=' + sort_by) %}
 {% set _ = query_params.append('order=' + order) %}
 {% set query_string = '&' + '&'.join(query_params) if query_params else '' %}

 {% if page > 1 %}
 <a href="/organizations?page={{ page - 1 }}{{ query_string }}" class="page-btn">← Назад</a>
 {% else %}
 <button class="page-btn" disabled>← Назад</button>
 {% endif %}

 {% for p in range(1, total_pages + 1) %}
 {% if p == page %}
 <span class="page-btn active">{{ p }}</span>
 {% elif p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
 <a href="/organizations?page={{ p }}{{ query_string }}" class="page-btn">{{ p }}</a>
 {% elif p == page - 3 or p == page + 3 %}
 <span class="page-btn" disabled>...</span>
 {% endif %}
 {% endfor %}

 {% if page < total_pages %}
 <a href="/organizations?page={{ page + 1 }}{{ query_string }}" class="page-btn">Вперёд →</a>
 {% else %}
 <button class="page-btn" disabled>Вперёд →</button>
 {% endif %}
</div>
 {% endif %}
</div>

 <script>
 let filtersOpen = true;

 // Toggle all filters at once
 function toggleAllFilters() {
 const filterNames = ['industry', 'district', 'region', 'size'];
 const btn = document.getElementById('toggleAllBtn');
 
 filterNames.forEach(filterName => {
 const content = document.getElementById('content-' + filterName);
 
 if (filtersOpen) {
 content.classList.add('collapsed');
 } else {
 content.classList.remove('collapsed');
 }
 });
 
 filtersOpen = !filtersOpen;
 btn.textContent = filtersOpen ? 'Скрыть все фильтры' : 'Показать все фильтры';
 }

 // Filter options based on search
 function filterOptions(filterName, searchValue) {
 const options = document.getElementById('options-' + filterName);
 const noResults = document.getElementById('no-results-' + filterName);
 const filterOptions = options.querySelectorAll('.filter-option');
 
 searchValue = searchValue.toLowerCase().trim();
 let visibleCount = 0;

 filterOptions.forEach(option => {
 const value = option.getAttribute('data-value');
 if (value.includes(searchValue)) {
 option.classList.remove('hidden');
 visibleCount++;
 } else {
 option.classList.add('hidden');
 }
 });

 // Show/hide "no results" message
 if (visibleCount === 0) {
 noResults.style.display = 'block';
 } else {
 noResults.style.display = 'none';
 }
 }

 // Keep all filters open on page load
 document.addEventListener('DOMContentLoaded', function() {
 const filterNames = ['industry', 'district', 'region', 'size'];
 
 filterNames.forEach(filterName => {
 const content = document.getElementById('content-' + filterName);
 content.classList.remove('collapsed');
 });
 });

 // Export to Excel function
 function exportToExcel() {
 // Build URL with current filters
 const params = new URLSearchParams();
 
 // Add search parameter
 const searchInput = document.querySelector('input[name="search"]');
 if (searchInput && searchInput.value) {
 params.append('search', searchInput.value);
 }
 
 // Add industry filters
 document.querySelectorAll('input[name="industry"]:checked').forEach(checkbox => {
 params.append('industry', checkbox.value);
 });
 
 // Add district filters
 document.querySelectorAll('input[name="district"]:checked').forEach(checkbox => {
 params.append('district', checkbox.value);
 });
 
 // Add region filters
 document.querySelectorAll('input[name="region"]:checked').forEach(checkbox => {
 params.append('region', checkbox.value);
 });
 
 // Add size filters
 document.querySelectorAll('input[name="size"]:checked').forEach(checkbox => {
 params.append('size', checkbox.value);
 });
 
 // Add sort parameters
 const sortBySelect = document.querySelector('select[name="sort_by"]');
 const orderSelect = document.querySelector('select[name="order"]');
 if (sortBySelect) {
 params.append('sort_by', sortBySelect.value);
 }
 if (orderSelect) {
 params.append('order', orderSelect.value);
 }
 
 // Open export URL in new window to download file
 const exportUrl = '/organizations/export?' + params.toString();
 window.location.href = exportUrl;
 }
</script>
</body>
</html>
